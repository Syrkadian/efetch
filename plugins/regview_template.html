<!DOCTYPE html>
<html>
    <head>
        <script src="/resources/jquery-1.11.3.min.js"></script>
        <script src="/resources/jquery-ui-1.11.4/jquery-ui.min.js" type="text/javascript"></script>
        <!-- Include Fancytree skin and library -->
        <link href="/resources/fancytree/skin-win8/ui.fancytree.css" rel="stylesheet" type="text/css">
        <link href="/resources/fa_regview.css" rel="stylesheet" type="text/css">
        <script src="/resources/fancytree/jquery.fancytree-all.js" type="text/javascript"></script>
        <script>
              $(function() {
            $('#tree').fancytree({
                source: { url: '/plugins/fa_regview_ajax/<!-- Path -->/?method=base' },
                autoScroll: true,
                init: function(event, data) {
                    data.tree.getFirstChild().setFocus();
                },
                focus: function(event, data){
                    data.node.scrollIntoView(true);
                },
                activate: function(event, data) {
                    node = data.node;
                    $.ajax(
                          { url: '/plugins/fa_regview_ajax/<!-- Path -->/?method=values',
                            data: {node_id: node.refKey},
                            success: function(data) {
                                var values_content = '<table class="values-table"><thead><tr><th>Key</th><th>Data Type</th> <th>Value</th></tr></thead>'
                                console.log(data);
                                for(var i = 0; i < data.length; i++) {
                                    var item = data[i];
                                    values_content = values_content + '<tr><td>' + item.name + '</td><td>' + item.type + '</td><td>' + item.value + '</td></tr>'
                                    /*if ( item.type == "RegSZ" || item.type == "RegDWord") {
                                        values_content = values_content + '<tr><td>' + item.name + '</td><td>' + item.type + '</td><td>' + item.value + '</td></tr>'
                                    }
                                    else {
                                        values_content = values_content + '<tr><td>' + item.name + '</td><td>' + item.type + '</td><td></td></tr>'
                                    }*/
                                }
                                values_content = values_content + '</table>'
                                $('#values').html(values_content);
                            }
                          }
                    );
                },
                lazyLoad: function(event, data) {
                    var node = data.node;
                    console.log(node);
                    // Issue an ajax request to load child nodes
                    data.result = {
                        url: "/plugins/fa_regview_ajax/<!-- Path -->/?method=children",
                        data: {node_id: node.refKey}
                    }
                }
            });
        });
        </script>
    </head>
    <body>
        <div class="registry-container">
            <div id="tree" class="registry-tree"></div>
            <div id="values" class="registry-values"></div>
        </div>
    </body>
</html>
