<!DOCTYPE html>
<html>
<head>
        <script src="/resources/jquery-1.11.3.min.js"></script>
        <script src="/resources/jquery-ui-1.11.4/jquery-ui.min.js" type="text/javascript"></script>
        <link rel="stylesheet" type="text/css" href="/resources/themes/default/easyui.css">
        <link rel="stylesheet" type="text/css" href="/resources/themes/color.css">
        <!--<link rel="stylesheet" type="text/css" href="/resources/demo/demo.css">-->
        <link rel="stylesheet" type="text/css" href="/resources/themes/icon.css">
        <script type="text/javascript" src="/resources/jquery.easyui.min.js"></script>

<style>
    html{
        height: 100%;
    }

    body {
        min-height: 100%;
        margin: 0px;
    }
</style>
</head>
    <body>
        <div class="easyui-panel" style="padding:5px;width:100%;border-left-style: none;border-right-style: none;">
            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="$('#add_case_window').window('open')" data-options="plain:true,iconCls:'icon-add'">Add Case</a>
            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="deleteCase()" data-options="plain:true,iconCls:'icon-remove'">Delete Case</a>
            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="editCase()" data-options="plain:true,iconCls:'icon-edit'">Edit Case</a>
            <a href="javascript:void(0)" class="easyui-linkbutton" onclick="openCase()" data-options="plain:true,iconCls:'icon-ok'">Open Case</a>
        </div>

        <!-- ADD CASE FORM -->
        <div id="add_case_window" class="easyui-window" title="Add Case" data-options="closed:true,iconCls:'icon-add'" style="width:340px;height:230px;padding:10px;">
            <div style="padding:10px 10px 20px 10px">
                <form id="ff" action="/plugins/fa_case/?method=create" method="post">
                    <table cellpadding="5">
                        <tr>
                            <td>Name:</td>
                            <td><input class="easyui-textbox" type="text" name="name" data-options="required:true"></input></td>
                        </tr>
                        <tr>
                            <td>Description:</td>
                            <td><input class="easyui-textbox" type="text" name="description" data-options="multiline:true" style="height:60px"></input></td>
                        </tr>
                    </table>
                </form>

                <div style="text-align:center;padding:5px">
                    <a href="javascript:void(0)" class="easyui-linkbutton" onclick="submitForm()">Submit</a>
                    <a href="javascript:void(0)" class="easyui-linkbutton" onclick="clearForm()">Clear</a>
                    <a href="javascript:void(0)" class="easyui-linkbutton" onclick="cancelForm()">Cancel</a>
                </div>
            </div>
        </div>
        <script>
            function submitForm(){
                $('#ff').form('submit');
                $('#ff').form('clear');
                $('#add_case_window').window('close');
                setTimeout(function(){$('#dg').datagrid('reload');}, 1000);
            }
            function clearForm(){
                $('#ff').form('clear');
            }
            function cancelForm(){
                $('#ff').form('clear');
                $('#add_case_window').window('close');
            }
            function deleteCase(){
                var row = $('#dg').datagrid('getSelected');
                if (row){
                    $.messager.confirm('Confirm','Are you sure you want to delete this case?',function(r){
                        if (r)
                            $.post('/plugins/fa_case/',{name:row.name, method:'delete'})
                                .done(function()
                                {
                                    setTimeout(function(){$('#dg').datagrid('reload');}, 1000);
                                })
                                .fail(function() 
                                {
                                    $.messager.show({   // show error message
                                        title: 'Error',
                                        msg: result.errorMsg
                                    });
                                });
                    });
                }
            }
            function editCase(){
                var row = $('#dg').datagrid('getSelected');
                if (row){
                    $('#add_case_window').dialog('open').dialog('center').dialog('setTitle','Edit Case');
                    $('#ff').form('load',row);
                    url = '/plugins/fa_case/?method=update';
                }
            }
            function openCase(){
                var row = $('#dg').datagrid('getSelected');
                if (row){
                    var win = window.open('/plugins/fa_header/fa_menu/fa_casetree/fa_dirtree/fa_filebrowser/fa_analyze/?case=' + row.name, '_blank');
                    win.focus();
                }
            }
        </script>

        <table id="dg" title="Cases" class="easyui-datagrid" style="width:100%;height:100%"
                url="/plugins/fa_case/?method=read_table"
                toolbar="#toolbar" 
                fitColumns="true" singleSelect="true">
            <thead>
                <tr>
                    <th field="name" width="20">Case Name</th>
                    <th field="description" width="40">Description</th>
                    <th field="evidence" width="40">Evidence</th>
                </tr>
            </thead>
        </table>
    </body>
</html>
